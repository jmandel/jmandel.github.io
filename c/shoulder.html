<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Right Shoulder Recovery – Guided Program & Tracker</title>
<meta name="description" content="A simple, mobile-first single-page app to guide and track a complete right-shoulder recovery program with embedded videos and local progress tracking." />
<!-- React via UNPKG + Babel for JSX-in-page (keeps this file standalone) -->
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<style>
  :root{
    --bg: #0b0c10;          /* dark base for good OLED/mobile */
    --card: #12141a;        /* cards */
    --ink: #f5f7fa;         /* primary text */
    --muted: #b7c0cc;       /* secondary text */
    --brand: #3fd1c1;       /* teal accent */
    --brand-2:#8ee3dc;      /* lighter accent */
    --ok: #43d17a;
    --warn:#ffb020;
    --danger:#ff6b6b;
    --line: #232834;
    --shadow: 0 10px 30px rgba(0,0,0,.35);
    --radius: 14px;
    --radius-sm: 10px;
    --space: clamp(14px, 3.5vw, 20px);
    --space-sm: clamp(8px, 2.2vw, 12px);
    --space-lg: clamp(18px, 4.2vw, 26px);
    --maxw: 820px;
    --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  }
  @media (prefers-color-scheme: light) {
    :root{
      --bg:#f7f9fc; --card:#ffffff; --ink:#0b1220; --muted:#475466; --line:#e7ecf2; --shadow: 0 10px 25px rgba(0,0,0,.07);
    }
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--ink); font: 16px/1.45 var(--font);
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }
  a{color:var(--brand); text-decoration:none}
  a:focus, button:focus, input:focus, textarea:focus{outline:2px solid var(--brand-2); outline-offset:3px; border-radius:8px}
  .wrap{max-width:var(--maxw); margin:0 auto; padding: calc(env(safe-area-inset-top) + 60px) var(--space) var(--space-lg);}
  header.sticky{
    position:fixed; inset:0 0 auto 0; height:56px; backdrop-filter:saturate(140%) blur(10px);
    display:flex; align-items:center; gap:10px; padding:8px var(--space); border-bottom:1px solid var(--line);
    background: color-mix(in srgb, var(--bg) 82%, transparent);
    z-index:999;
  }
  .brand{font-weight:700; letter-spacing:.2px}
  .bar{
    flex:1; height:10px; background:linear-gradient(90deg, #202636, #1a202c);
    border-radius:999px; overflow:hidden; border:1px solid var(--line);
  }
  .bar > i{display:block; height:100%; width:0%; background:linear-gradient(90deg, var(--brand), var(--brand-2)); transition:width .3s ease}
  .kpi{font-size:.85rem; color:var(--muted)}
  .pill{display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border:1px solid var(--line); border-radius:999px; background:var(--card)}
  .pill small{color:var(--muted)}
  .stack{display:grid; gap: var(--space)}
  section{scroll-margin-top:80px;}
  .card{
    background:var(--card); border:1px solid var(--line); border-radius: var(--radius); box-shadow:var(--shadow);
    padding: var(--space); display:grid; gap: var(--space-sm);
  }
  .card h2, .card h3{margin:0}
  .card h2{font-size: clamp(20px, 4.6vw, 26px)}
  .card h3{font-size: clamp(18px, 4.2vw, 22px)}
  .sub{color:var(--muted); margin-top:-4px}
  .toc{display:flex; flex-wrap:wrap; gap:10px}
  .toc a{border:1px solid var(--line); background:var(--card); padding:10px 12px; border-radius:999px}
  .grid{display:grid; gap: var(--space); grid-template-columns:1fr}
  .row{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
  .hint{font-size:.95rem; color:var(--muted)}
  .badge{font-size:.8rem; padding:4px 8px; border:1px solid var(--line); border-radius:999px; color:var(--muted)}
  .ok{color:var(--ok)} .warn{color:var(--warn)} .danger{color:var(--danger)}
  .btn{
    appearance:none; border:1px solid var(--line); background:linear-gradient(180deg, #1a202c, #151a24);
    color:var(--ink); padding:12px 14px; border-radius:12px; font-weight:600; box-shadow:var(--shadow);
  }
  .btn:active{transform:translateY(1px)}
  .btn.secondary{background:var(--card)}
  .btn.small{padding:8px 10px; border-radius:10px; font-weight:600}
  .btn.danger{border-color:color-mix(in srgb, var(--danger) 60%, var(--line)); background:linear-gradient(180deg, #311919, #241112); color:#ffdede}
  label, .label{font-weight:600}
  .field{display:grid; gap:6px}
  input, textarea, select{
    width:100%; padding:12px 12px; border:1px solid var(--line); border-radius:12px; background:transparent; color:var(--ink)
  }
  input[type="range"]{padding:0}
  .range{
    display:grid; gap:8px; align-items:center
  }
  .range .scale{display:flex; justify-content:space-between; font-size:.8rem; color:var(--muted)}
  .exercise{
    display:grid; gap:10px; border:1px dashed var(--line); border-radius: var(--radius-sm); padding:14px;
    background: color-mix(in srgb, var(--card) 90%, transparent);
  }
  .exercise .title{display:flex; justify-content:space-between; gap:8px; align-items:center}
  .sets{display:flex; gap:8px; flex-wrap:wrap}
  .setbox{
    display:inline-flex; align-items:center; justify-content:center; width:38px; height:38px; border-radius:10px;
    border:1px solid var(--line); background:linear-gradient(180deg, #161b24, #10141c); font-weight:700; user-select:none; cursor:pointer;
  }
  .setbox[aria-checked="true"]{
    background:linear-gradient(180deg, #10332d, #0f2b26); color:#b6fff4; border-color: color-mix(in srgb, var(--brand) 60%, var(--line));
    box-shadow: inset 0 0 0 2px color-mix(in srgb, var(--brand) 40%, transparent);
  }
  .cue{color:var(--muted); font-size:.95rem}
  iframe{width:100%; aspect-ratio:16/9; border:0; border-radius:12px}
  .progressline{
    height:8px; border-radius:6px; background: #1c2433; overflow:hidden; border:1px solid var(--line);
  }
  .progressline > i{display:block; height:100%; width:0; background:linear-gradient(90deg, var(--brand), var(--brand-2))}
  footer{color:var(--muted); font-size:.9rem}
  .fine{font-size:.9rem; color:var(--muted)}
  /* Anchor targets comfortable on mobile */
  h2[id], h3[id]{scroll-margin-top:84px}
</style>
</head>
<body>
  <header class="sticky">
    <div class="brand">Right Shoulder Recovery</div>
    <div class="bar"><i id="hdrProgress" style="width:0%"></i></div>
    <div class="kpi" id="hdrKpi">0/0</div>
  </header>

  <main class="wrap">
    <div id="app" class="stack" role="main" aria-live="polite"></div>
  </main>

<script type="text/babel">
const { useState, useEffect, useMemo, useCallback } = React;

// ---------- Program Data (phases & exercises) ----------
const YT = (id) => `https://www.youtube-nocookie.com/embed/${id}`;
const PROGRAM = [
  {
    id: 0,
    slug: 'phase-0',
    name: 'Phase 0 – Flare Control (3–7 days)',
    goal: 'Calm irritation fast, keep motion, relieve pain via isometrics, avoid end-range impingement.',
    notes: 'Keep all pain ≤3/10 during the work and back to baseline by next day. Limit loaded internal rotation and overhead >90° right now.',
    exercises: [
      { id:'pendulums', title:'Pendulums (Codman)', sets:1, freq:'2–3×/day during flare', reps:'30–60s each direction', video:YT('QF_ubbr_RUE'),
        cues:'Relax the shoulder; lean and let gravity move the arm. Small, smooth circles.' },
      { id:'wall-slides', title:'Wall/Table Slides (forward)', sets:2, freq:'1–2×/day', reps:'2×10 smooth reps', video:YT('4QqcbCjnnlw'),
        cues:'Glide the arms up with a towel; stay below or at ~90° if that’s more comfortable.' },
      { id:'scap-set', title:'Scapular Setting', sets:5, freq:'Spread through day', reps:'5×10s holds', video:null,
        cues:'Stand tall, “long neck”, shoulder blades gently down/back (no hard pinching). Breathe.' },
      { id:'iso-ir', title:'Isometric Internal Rotation @ side', sets:4, freq:'1–2×/day', reps:'4×30–45s easy holds', video:YT('lB2fnJzqEqM'),
        cues:'Elbow on a towel at ribs; press forearm into belly gently without moving.' },
      { id:'iso-er', title:'Isometric External Rotation @ side', sets:4, freq:'1–2×/day', reps:'4×30–45s easy holds', video:null,
        cues:'Elbow on towel; press back of hand into doorframe gently without moving.' },
      { id:'iso-abd', title:'Isometric Abduction (arm by side)', sets:4, freq:'1–2×/day', reps:'4×30–45s easy holds', video:null,
        cues:'Arm at side; press outward into wall/hand softly, no hiking of the shoulder.' },
      { id:'iso-biceps', title:'Isometric Biceps', sets:4, freq:'1–2×/day', reps:'4×30–45s easy holds', video:null,
        cues:'Elbow 90°; try to bend into your other hand without moving.' },
    ]
  },
  {
    id: 1,
    slug: 'phase-1',
    name: 'Phase 1 – Mobility (Daily, continue throughout)',
    goal: 'Restore comfortable movement in the shoulder and upper back without provoking symptoms.',
    notes: 'Gentle, slow, and never forced. Skip “sleeper” and behind-back stretches if they increase pain.',
    exercises: [
      { id:'t-spine-ext', title:'Thoracic Extension (over towel/roller)', sets:1, freq:'Daily', reps:'5 slow reps at 2–3 spots', video:YT('csjTuWpZA10'),
        cues:'Support your head/neck; breathe out as you extend over the towel/roller.' },
      { id:'pec-door', title:'Doorway Pec Stretch (elbow below shoulder)', sets:3, freq:'Daily', reps:'3×30s each', video:YT('XSvYPcRlvFI'),
        cues:'Step through gently; feel stretch across the chest, not sharp pain in the shoulder.' },
      { id:'lat-counter', title:'Lat / Counter Stretch', sets:3, freq:'Daily', reps:'3×30s', video:YT('x1SdnOkQoo0'),
        cues:'Hands on counter, sit hips back; keep ribs tucked and breathe.' },
      { id:'posterior-capsule', title:'Cross‑Body Posterior Capsule Stretch', sets:3, freq:'Daily', reps:'3×30s', video:YT('6rD9qaa1790'),
        cues:'Support the upper arm; pull across gently; no pinching on top of shoulder.' },
      { id:'towel-ir-optional', title:'Towel Internal‑Rotation (Optional, pain‑free only)', sets:2, freq:'Optional', reps:'2×20–30s', video:null,
        cues:'Very gentle. Skip if it reproduces your symptoms.' },
    ]
  },
  {
    id: 2,
    slug: 'phase-2',
    name: 'Phase 2 – Scapular Control & Rotator Cuff (3×/week)',
    goal: 'Build strength and control in safe arcs (mostly ≤90°), emphasize slow eccentrics and good mechanics.',
    notes: 'Use light loads. Thumbs‑up (full‑can), elbow near body for IR/ER. Progress when 3×15 is easy with pain ≤3/10.',
    exercises: [
      { id:'serratus-supine', title:'Serratus Punches (supine or band)', sets:3, freq:'3×/wk', reps:'3×12', video:YT('EA2DVgQ_J_U'),
        cues:'Reach to the ceiling by sliding shoulder blade forward; don’t shrug your neck.' },
      { id:'wall-slide-band', title:'Wall Slide (roller) + light band', sets:2, freq:'3×/wk', reps:'2×8 slow to ≤90°', video:YT('EugElNVC2BU'),
        cues:'Forearms on roller; press band out lightly; slide up only to comfort.' },
      { id:'prone-y', title:'Prone “Y” (thumbs up)', sets:2, freq:'3×/wk', reps:'2×10 small range', video:YT('SqIjED6yHKs'),
        cues:'Think lower traps + long neck; tiny range is fine.' },
      { id:'sidelying-er', title:'Sidelying External Rotation (light DB)', sets:3, freq:'3×/wk', reps:'3×12, 1–2s pause', video:YT('YzL3koB1mE4'),
        cues:'Towel at elbow; slow, smooth, no neck tension.' },
      { id:'band-ir', title:'Band Internal Rotation @ side', sets:3, freq:'3×/wk', reps:'3×12', video:YT('lB2fnJzqEqM'),
        cues:'Elbow hugs towel; rotate only through the shoulder, not the trunk.' },
      { id:'scaption', title:'Scaption (Full‑Can) to 70–90°', sets:3, freq:'3×/wk', reps:'3×10–12', video:YT('WV3qHhypasc'),
        cues:'Thumbs up; raise in the scapular plane; slow lower.' },
      { id:'rows', title:'Rows (band or chest‑supported)', sets:3, freq:'3×/wk', reps:'3×12', video:YT('ZIAQvUA_wbs'),
        cues:'Elbows ~30–45° from body; squeeze shoulder blades gently together.' },
      { id:'eccentric-lowers', title:'Eccentric Scaption/Abduction Lowers', sets:3, freq:'2–3×/wk', reps:'3×6 w/4–5s lowers', video:YT('tVgB1P8zDlw'),
        cues:'Help the arm up with the other hand to ~70–90°, then lower slowly for 4–5s.' },
    ]
  },
  {
    id: 3,
    slug: 'phase-3',
    name: 'Phase 3 – Functional Loading & Carry Progression (2–3×/week)',
    goal: 'Reload everyday tasks (groceries, suitcase) without flares; gradual increases ≤10%/week.',
    notes: 'Keep weights close; avoid twisting inward while lifting away from the body. Switch hands often early on.',
    exercises: [
      { id:'farmers', title:'Farmer’s Carry (two hands)', sets:3, freq:'2–3×/wk', reps:'3×20–30 m', video:YT('vW81EITekU0'),
        cues:'Stand tall, ribs down; weights “zippered” to your sides; small elbow bend.' },
      { id:'suitcase-right', title:'Suitcase Carry (right)', sets:3, freq:'2–3×/wk', reps:'3×20–30 m', video:YT('y-hn_Ha1-RE'),
        cues:'Light to start; switch hands often; keep shoulder from drifting forward.' },
      { id:'suitcase-left', title:'Suitcase Carry (left)', sets:3, freq:'2–3×/wk', reps:'3×20–30 m', video:YT('y-hn_Ha1-RE'),
        cues:'Train both sides; same cues as right.' },
      { id:'bottoms-up-kb', title:'Bottoms‑Up KB Hold/Carry (optional)', sets:2, freq:'2×/wk', reps:'2×20–30s', video:YT('UpBzi0HIdAI'),
        cues:'Light bell, tall posture; wobble is the point—keep it controlled.' },
      { id:'band-press-scap', title:'Banded Press in Scapular Plane (~90°)', sets:2, freq:'2–3×/wk', reps:'2–3×10', video:YT('s4BCCOF08JI'),
        cues:'Thumbs up; press to ~90° only while calm; no pinching.' },
    ]
  }
];

const PAIN_RULES = [
  "During exercise keep pain at or under 3/10.",
  "Pain should return to your usual baseline by the next day.",
  "If next‑day pain is higher or lingers >24h, reduce next session’s load/range by 30–50% or regress.",
  "Favor slow lowers (eccentrics) and isometrics; avoid fast, jerky motions.",
  "Use thumbs‑up (full‑can) positions and keep elbow near body for IR/ER.",
];

const STORAGE_KEY = "right_shoulder_app_state_v1";

// ---------- Helpers ----------
const todayStr = () => {
  const d = new Date(); const tzOffset = d.getTimezoneOffset() * 60000;
  return new Date(Date.now() - tzOffset).toISOString().slice(0,10);
};
const clamp = (n, lo, hi) => Math.max(lo, Math.min(hi, n));
const loadState = () => {
  try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; }
  catch { return {}; }
};
const saveState = (s) => localStorage.setItem(STORAGE_KEY, JSON.stringify(s, null, 2));
const supportsLocal = (() => { try{ localStorage.setItem("__t","1"); localStorage.removeItem("__t"); return true;} catch {return false;} })();

// ---------- Core App ----------
function App(){
  const [date, setDate] = useState(() => loadState().date || todayStr());
  const [phase, setPhase] = useState(() => loadState().phase ?? 0);
  const [data, setData] = useState(() => loadState().data || {}); // { [date]: { painDuring, painNextDay, notes, progress: { [exerciseId]: [booleans] } } }

  // persist
  useEffect(() => { saveState({ date, phase, data }); }, [date, phase, data]);

  // derived: active exercises (all up to current phase)
  const activeExercises = useMemo(() => {
    const list = [];
    PROGRAM.forEach(p => {
      if (p.id <= phase) p.exercises.forEach(e => list.push({...e, phase:p.id}));
    });
    return list;
  }, [phase]);

  // total sets vs completed sets for header progress
  const progressForDate = data[date]?.progress || {};
  const totals = useMemo(() => {
    let total = 0, done = 0;
    activeExercises.forEach(ex => {
      const sets = ex.sets || 0;
      total += sets;
      const arr = progressForDate[ex.id] || [];
      done += arr.filter(Boolean).length;
    });
    return { total, done };
  }, [activeExercises, progressForDate]);
  useEffect(() => {
    const pct = totals.total ? Math.round((totals.done / totals.total) * 100) : 0;
    const bar = document.getElementById('hdrProgress');
    const kpi = document.getElementById('hdrKpi');
    if(bar) bar.style.width = pct + '%';
    if(kpi) kpi.textContent = `${totals.done}/${totals.total}`;
  }, [totals]);

  // update helpers
  const ensureDateEntry = useCallback((d) => {
    setData(prev => {
      const next = {...prev};
      if(!next[d]) next[d] = { painDuring:0, painNextDay:0, notes:'', progress:{} };
      return next;
    });
  }, []);
  useEffect(() => { ensureDateEntry(date); }, [date]);

  const toggleSet = (exId, setIndex) => {
    setData(prev => {
      const next = {...prev};
      if(!next[date]) next[date] = { painDuring:0, painNextDay:0, notes:'', progress:{} };
      const arr = next[date].progress[exId] ? [...next[date].progress[exId]] : [];
      arr[setIndex] = !arr[setIndex];
      next[date].progress[exId] = arr;
      return next;
    });
  };

  const markAllSets = (exId, sets, value=true) => {
    setData(prev => {
      const next = {...prev};
      if(!next[date]) next[date] = { painDuring:0, painNextDay:0, notes:'', progress:{} };
      next[date].progress[exId] = Array.from({length: sets}, () => !!value);
      return next;
    });
  };

  const updatePain = (field, val) => {
    setData(prev => {
      const next = {...prev};
      if(!next[date]) next[date] = { painDuring:0, painNextDay:0, notes:'', progress:{} };
      next[date][field] = clamp(Number(val), 0, 10);
      return next;
    });
  };

  const updateNotes = (text) => {
    setData(prev => {
      const next = {...prev};
      if(!next[date]) next[date] = { painDuring:0, painNextDay:0, notes:'', progress:{} };
      next[date].notes = text.slice(0, 2000);
      return next;
    });
  };

  const resetToday = () => {
    if(confirm('Clear today’s progress, pain, and notes?')) {
      setData(prev => {
        const next = {...prev};
        next[date] = { painDuring:0, painNextDay:0, notes:'', progress:{} };
        return next;
      });
    }
  };

  const resetAll = () => {
    if(confirm('This will erase ALL saved data for all days. Proceed?')) {
      setPhase(0); setData({}); setDate(todayStr());
      saveState({ date: todayStr(), phase: 0, data: {} });
    }
  };

  const exportJson = () => {
    const blob = new Blob([JSON.stringify({ date, phase, data }, null, 2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'shoulder_recovery_backup.json';
    document.body.appendChild(a); a.click(); a.remove();
    setTimeout(() => URL.revokeObjectURL(url), 1000);
  };

  const importJson = (file) => {
    if(!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      try{
        const parsed = JSON.parse(reader.result);
        if(typeof parsed !== 'object') throw new Error('Invalid file');
        setDate(parsed.date || todayStr());
        setPhase(Number.isInteger(parsed.phase) ? parsed.phase : 0);
        setData(parsed.data || {});
        alert('Import successful.');
      } catch(e){ alert('Import failed: ' + e.message); }
    };
    reader.readAsText(file);
  };

  // ---------- UI ----------
  return (
    <div className="stack">
      {!supportsLocal && (
        <section className="card">
          <h2>Heads up: local storage unavailable</h2>
          <p className="sub">Your browser blocked localStorage (private mode?). Progress won’t be saved between visits.</p>
        </section>
      )}

      <section className="card" id="start">
        <h2>Program Overview</h2>
        <p className="sub">Purpose-built for your <b>right</b> shoulder. Follow a graded plan, keep pain ≤3/10, and track daily progress below.</p>
        <div className="toc" aria-label="Jump links">
          <a href="#guardrails">Guardrails</a>
          <a href="#log">Today’s Log</a>
          <a href="#phase-0">Phase 0</a>
          <a href="#phase-1">Phase 1</a>
          <a href="#phase-2">Phase 2</a>
          <a href="#phase-3">Phase 3</a>
          <a href="#why">Why this works</a>
          <a href="#retests">Re‑tests</a>
          <a href="#safety">When to escalate</a>
        </div>
        <div className="grid">
          <div className="row">
            <div className="pill">
              <span className="label">Date</span>
              <input aria-label="Selected date" type="date" value={date} onChange={e=>setDate(e.target.value)} />
            </div>
            <div className="pill" role="group" aria-label="Current phase">
              <span className="label">Phase</span>
              <select value={phase} onChange={e=>setPhase(Number(e.target.value))}>
                {PROGRAM.map(p => <option key={p.id} value={p.id}>{p.name}</option>)}
              </select>
            </div>
            <div className="pill kpi"><small>Progress</small> <b>{totals.done}/{totals.total}</b></div>
          </div>
          <div className="progressline" aria-hidden="true"><i style={{width: totals.total? `${Math.round((totals.done/totals.total)*100)}%` : '0%'}}/></div>
          <p className="hint">Tip: Phase sets the focus, but all earlier phases remain visible below. Your progress bar counts sets in the selected phase <em>and</em> earlier ones.</p>
          <div className="row">
            <button className="btn small secondary" onClick={resetToday}>Reset today</button>
            <button className="btn small" onClick={exportJson}>Export</button>
            <label className="btn small secondary" style={{cursor:'pointer'}}>
              Import <input type="file" accept="application/json" hidden onChange={e=>importJson(e.target.files[0])}/>
            </label>
            <button className="btn small danger" onClick={resetAll}>Reset all</button>
          </div>
        </div>
      </section>

      <section className="card" id="guardrails">
        <h2>Pain Rules & Guardrails</h2>
        <ul>{PAIN_RULES.map((r,i)=><li key={i}>{r}</li>)}</ul>
        <p className="fine">Avoid heavy one‑hand carries and positions of internal rotation + adduction (arm twisted in across chest) during flares. Prefer thumbs‑up raising and elbow near the body.</p>
      </section>

      <section className="card" id="log" aria-label="Daily log">
        <h2>Today’s Log</h2>
        <div className="grid">
          <div className="field range">
            <label htmlFor="painDuring">Pain during exercise (0–10)</label>
            <input id="painDuring" type="range" min="0" max="10" step="1" value={data[date]?.painDuring ?? 0} onChange={e=>updatePain('painDuring', e.target.value)} />
            <div className="scale"><span>0</span><span>5</span><span>10</span></div>
            <div className="hint">Keep ≤3/10 while you train.</div>
          </div>
          <div className="field range">
            <label htmlFor="painNext">Next‑day pain (0–10)</label>
            <input id="painNext" type="range" min="0" max="10" step="1" value={data[date]?.painNextDay ?? 0} onChange={e=>updatePain('painNextDay', e.target.value)} />
            <div className="scale"><span>0</span><span>5</span><span>10</span></div>
            <div className="hint">Should be back at baseline by the next day. If not, scale back load/range.</div>
          </div>
          <div className="field">
            <label htmlFor="notes">Notes (triggers, loads, wins)</label>
            <textarea id="notes" rows="4" placeholder="e.g., 10 lb suitcase carry calm; Hawkins felt dull today; slept better on back with pillow under arm."
              value={data[date]?.notes ?? ''} onChange={e=>updateNotes(e.target.value)} />
          </div>
        </div>
      </section>

      {PROGRAM.map(phaseObj => (
        <PhaseSection key={phaseObj.id}
          active={phaseObj.id <= phase}
          phaseObj={phaseObj}
          date={date}
          progress={data[date]?.progress || {}}
          onToggle={toggleSet}
          onMarkAll={markAllSets}
        />
      ))}

      <section className="card" id="why">
        <h2>What’s going on & why this plan works</h2>
        <p className="sub">Your pattern fits <b>subacromial shoulder pain / rotator‑cuff overload</b>: pain with internal rotation in flexion (Hawkins‑like), reaching overhead, and after one‑hand carries. Guarding kicks in; other muscles get sore helping.</p>
        <ul>
          <li><b>Phase 0</b> calms symptoms with isometrics (analgesic effect) and gentle motion to avoid stiffening.</li>
          <li><b>Phase 1</b> restores mobility in the thoracic spine, pecs, lats, and posterior capsule—freeing the shoulder.</li>
          <li><b>Phase 2</b> builds scapular control and rotator‑cuff strength in safer arcs (thumbs‑up, elbow near body) with slow eccentrics.</li>
          <li><b>Phase 3</b> reloads daily tasks (farmer/suitcase carries, light pressing) with graded exposure so flares stop happening.</li>
        </ul>
        <p className="fine">Technique keys: breathe out on effort; avoid neck bracing; use a towel between elbow & ribs for IR/ER; move slow and smooth; stop if pain >3/10.</p>
      </section>

      <section className="card" id="retests">
        <h2>Monthly Re‑tests (quick)</h2>
        <ul>
          <li><b>Hawkins</b> (arm forward 90°, elbow 90°, rotate down): should trend sharp → dull → none over time.</li>
          <li><b>Lowering from 90°</b>: feel less guarding and smoother control.</li>
          <li><b>Light shelf reach</b>: place a light object at shoulder height without a spike.</li>
          <li><b>Strength</b>: 3×15 sidelying ER at the same load should feel easier.</li>
        </ul>
      </section>

      <section className="card" id="safety">
        <h2>When to get in‑person help</h2>
        <ul>
          <li>Sudden pop, deformity, or you can’t lift the arm.</li>
          <li>Numbness/tingling, progressive weakness, or neck pain shooting past the elbow.</li>
          <li>Night pain that doesn’t improve in 2–3 weeks, steadily shrinking motion, or no progress after ~6 weeks following the rules.</li>
        </ul>
        <p className="fine">This app does not replace a clinical exam; it operationalizes a safe, evidence‑informed progression for common shoulder pain patterns.</p>
      </section>

      <footer className="stack">
        <p className="fine">Made for mobile. Data stays local (browser localStorage). Export regularly if you want a backup.</p>
      </footer>
    </div>
  );
}

function PhaseSection({ active, phaseObj, date, progress, onToggle, onMarkAll }){
  return (
    <section className="card" id={phaseObj.slug} style={{borderColor: active ? 'var(--brand)' : 'var(--line)'}}>
      <h2>{phaseObj.name}</h2>
      <p className="sub"><b>Goal:</b> {phaseObj.goal}</p>
      <p className="hint">{phaseObj.notes}</p>

      <div className="grid">
        {phaseObj.exercises.map(ex => (
          <ExerciseCard key={ex.id}
            ex={ex}
            date={date}
            progress={progress[ex.id] || []}
            onToggle={onToggle}
            onMarkAll={onMarkAll}
          />
        ))}
      </div>
    </section>
  );
}

function ExerciseCard({ ex, date, progress, onToggle, onMarkAll }){
  const completed = progress.filter(Boolean).length;
  const total = ex.sets || 0;
  const pct = total ? Math.round((completed/total)*100) : 0;

  return (
    <div className="exercise">
      <div className="title">
        <div>
          <h3>{ex.title}</h3>
          <div className="row">
            <span className="badge">{ex.reps}</span>
            <span className="badge">{ex.freq}</span>
          </div>
        </div>
        <div style={{minWidth:72, textAlign:'right'}}>
          <div className="kpi">{completed}/{total}</div>
          <div className="progressline" aria-hidden="true"><i style={{width: total? `${pct}%` : '0%'}}/></div>
        </div>
      </div>

      {ex.video && (
        <iframe
          loading="lazy"
          src={ex.video}
          title={`${ex.title} video`}
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          referrerPolicy="strict-origin-when-cross-origin"
          allowFullScreen
        ></iframe>
      )}

      <p className="cue">{ex.cues}</p>

      <div className="sets" role="group" aria-label={`${ex.title} sets`}>
        {Array.from({length: ex.sets || 0}).map((_,i) => {
          const checked = !!progress[i];
          return (
            <div key={i}
              className="setbox"
              role="checkbox"
              aria-checked={checked}
              tabIndex={0}
              onClick={()=>onToggle(ex.id, i)}
              onKeyDown={(e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); onToggle(ex.id, i); } }}>
              {i+1}
            </div>
          );
        })}
      </div>

      <div className="row">
        <button className="btn small secondary" onClick={()=>onMarkAll(ex.id, ex.sets, false)}>Clear</button>
        <button className="btn small" onClick={()=>onMarkAll(ex.id, ex.sets, true)}>Mark all done</button>
      </div>
    </div>
  );
}

// ---------- Render ----------
ReactDOM.createRoot(document.getElementById('app')).render(<App />);
</script>
</body>
</html>
