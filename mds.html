<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MDS Explorer - Learn Multidimensional Scaling</title>
    
    <!-- React and ReactDOM from CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Standalone for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Default confusion matrix based on phonetic similarity
        const DEFAULT_ANIMALS = ['Cat', 'Bat', 'Rat', 'Dog', 'Frog', 'Bird', 'Fish'];

        // Confusion matrix: higher values = more similar/confused
        const DEFAULT_CONFUSION_MATRIX = [
          [10, 8, 8, 2, 2, 1, 1],  // Cat
          [8, 10, 9, 1, 2, 1, 1],  // Bat
          [8, 9, 10, 1, 2, 1, 1],  // Rat
          [2, 1, 1, 10, 7, 2, 2],  // Dog
          [2, 2, 2, 7, 10, 2, 2],  // Frog
          [1, 1, 1, 2, 2, 10, 4],  // Bird
          [1, 1, 1, 2, 2, 4, 10],  // Fish
        ];

        const DEFAULT_ANIMAL_EMOJIS = {
          'Cat': '🐱', 'Bat': '🦇', 'Rat': '🐭', 'Dog': '🐕',
          'Frog': '🐸', 'Bird': '🐦', 'Fish': '🐟'
        };

        const ANIMAL_COLORS = {
          'Cat': '#fca5a5', 'Bat': '#c084fc', 'Rat': '#fbbf24', 'Dog': '#5eead4',
          'Frog': '#86efac', 'Bird': '#93c5fd', 'Fish': '#fda4af'
        };

        // Generate color for any animal based on hash
        const getColorForAnimal = (animal) => {
          if (ANIMAL_COLORS[animal]) return ANIMAL_COLORS[animal];
          
          // Generate color from string hash
          let hash = 0;
          for (let i = 0; i < animal.length; i++) {
            hash = animal.charCodeAt(i) + ((hash << 5) - hash);
          }
          const hue = hash % 360;
          return `hsl(${hue}, 70%, 75%)`;
        };

        function MDSExplorer() {
          const [animals, setAnimals] = useState(DEFAULT_ANIMALS);
          const [animalEmojis, setAnimalEmojis] = useState(DEFAULT_ANIMAL_EMOJIS);
          const [confusionMatrix, setConfusionMatrix] = useState(DEFAULT_CONFUSION_MATRIX);
          const [positions, setPositions] = useState({});
          const [dragging, setDragging] = useState(null);
          const [stress, setStress] = useState(100);
          const canvasRef = useRef(null);

          // Parse URL parameters on mount
          useEffect(() => {
            const params = new URLSearchParams(window.location.search);
            
            // Parse animals parameter with optional emoji (format: Label:Emoji or just Label)
            const animalsParam = params.get('animals');
            if (animalsParam) {
              const items = animalsParam.split(',').map(a => a.trim()).filter(a => a.length > 0);
              if (items.length >= 3) {
                const animalsList = [];
                const emojiMap = {};
                
                items.forEach(item => {
                  // Check if item contains emoji separator
                  if (item.includes(':')) {
                    const [label, emoji] = item.split(':').map(s => s.trim());
                    animalsList.push(label);
                    emojiMap[label] = emoji;
                  } else {
                    animalsList.push(item);
                    // Use default emoji if available, otherwise use ❓
                    emojiMap[item] = DEFAULT_ANIMAL_EMOJIS[item] || '❓';
                  }
                });
                
                setAnimals(animalsList);
                setAnimalEmojis(emojiMap);
              }
            }
            
            // Parse matrix parameter (JSON array or semicolon-separated rows)
            const matrixParam = params.get('matrix');
            if (matrixParam) {
              try {
                // Try JSON format first: [[10,8,2],[8,10,3],[2,3,10]]
                const matrix = JSON.parse(decodeURIComponent(matrixParam));
                if (Array.isArray(matrix) && matrix.length >= 3 && 
                    matrix.every(row => Array.isArray(row) && row.length === matrix.length)) {
                  setConfusionMatrix(matrix);
                }
              } catch (e) {
                try {
                  // Try semicolon-separated format: 10,8,2;8,10,3;2,3,10
                  const rows = matrixParam.split(';');
                  const matrix = rows.map(row => 
                    row.split(',').map(val => parseFloat(val.trim())).filter(v => !isNaN(v))
                  );
                  if (matrix.length >= 3 && matrix.every(row => row.length === matrix.length)) {
                    setConfusionMatrix(matrix);
                  }
                } catch (e2) {
                  console.error('Could not parse matrix parameter:', e2);
                }
              }
            }
          }, []);

          // Initialize random positions
          useEffect(() => {
            initializePositions();
          }, [animals]);

          const initializePositions = () => {
            const newPositions = {};
            animals.forEach((animal, i) => {
              const angle = (i / animals.length) * Math.PI * 2;
              const radius = 0.3;
              newPositions[animal] = {
                x: 0.5 + radius * Math.cos(angle),
                y: 0.5 + radius * Math.sin(angle)
              };
            });
            setPositions(newPositions);
          };

          // Calculate stress
          useEffect(() => {
            if (Object.keys(positions).length === 0) return;
            
            // Ensure all animals have positions before calculating
            const allPositionsReady = animals.every(animal => positions[animal] !== undefined);
            if (!allPositionsReady) return;
            
            const distanceMatrix = calculateDistanceMatrix();
            const dissimilarityMatrix = confusionMatrixToDissimilarity(confusionMatrix);
            const calculatedStress = calculateStress(distanceMatrix, dissimilarityMatrix);
            setStress(calculatedStress);
          }, [positions, confusionMatrix, animals]);

          const confusionMatrixToDissimilarity = (matrix) => {
            const maxVal = Math.max(...matrix.flat());
            return matrix.map(row => row.map(val => maxVal - val));
          };

          const calculateDistanceMatrix = () => {
            const matrix = [];
            animals.forEach((animal1, i) => {
              matrix[i] = [];
              animals.forEach((animal2, j) => {
                if (i === j) {
                  matrix[i][j] = 0;
                } else {
                  const pos1 = positions[animal1];
                  const pos2 = positions[animal2];
                  // Guard against undefined positions during initialization
                  if (!pos1 || !pos2) {
                    matrix[i][j] = 0;
                    return;
                  }
                  const dist = Math.sqrt(
                    Math.pow(pos1.x - pos2.x, 2) + Math.pow(pos1.y - pos2.y, 2)
                  );
                  matrix[i][j] = dist;
                }
              });
            });
            return matrix;
          };

          const calculateStress = (distances, dissimilarities) => {
            let numerator = 0;
            let denominator = 0;

            for (let i = 0; i < animals.length; i++) {
              for (let j = i + 1; j < animals.length; j++) {
                const diff = distances[i][j] - dissimilarities[i][j] * 0.1;
                numerator += diff * diff;
                denominator += distances[i][j] * distances[i][j];
              }
            }

            return denominator > 0 ? Math.sqrt(numerator / denominator) * 100 : 100;
          };

          const handleMouseDown = (animal, e) => {
            e.preventDefault();
            setDragging(animal);
          };

          const handleMouseMove = (e) => {
            if (!dragging || !canvasRef.current) return;

            const rect = canvasRef.current.getBoundingClientRect();
            const x = (e.clientX - rect.left) / rect.width;
            const y = (e.clientY - rect.top) / rect.height;

            setPositions(prev => ({
              ...prev,
              [dragging]: { 
                x: Math.max(0.1, Math.min(0.9, x)), 
                y: Math.max(0.1, Math.min(0.9, y)) 
              }
            }));
          };

          const handleTouchMove = (e) => {
            if (!dragging || !canvasRef.current) return;
            e.preventDefault();

            const touch = e.touches[0];
            const rect = canvasRef.current.getBoundingClientRect();
            const x = (touch.clientX - rect.left) / rect.width;
            const y = (touch.clientY - rect.top) / rect.height;

            setPositions(prev => ({
              ...prev,
              [dragging]: { 
                x: Math.max(0.1, Math.min(0.9, x)), 
                y: Math.max(0.1, Math.min(0.9, y)) 
              }
            }));
          };

          const handleMouseUp = () => setDragging(null);

          const handleReset = () => initializePositions();

          const handleCopyURL = () => {
            const baseURL = window.location.origin + window.location.pathname;
            // Format animals with emoji: Label:Emoji
            const animalsParam = animals.map(animal => `${animal}:${animalEmojis[animal] || '❓'}`).join(',');
            const matrixParam = confusionMatrix.map(row => row.join(',')).join(';');
            const url = `${baseURL}?animals=${encodeURIComponent(animalsParam)}&matrix=${encodeURIComponent(matrixParam)}`;
            
            navigator.clipboard.writeText(url).then(() => {
              alert('URL copied to clipboard! Share it to load this configuration.');
            }).catch(err => {
              console.error('Failed to copy URL:', err);
              // Fallback: show the URL in a prompt
              prompt('Copy this URL:', url);
            });
          };

          const handleAutoSolve = () => {
            const dissimilarities = confusionMatrixToDissimilarity(confusionMatrix);
            let currentPositions = { ...positions };
            
            for (let iter = 0; iter < 100; iter++) {
              const gradients = {};
              
              animals.forEach(animal => {
                gradients[animal] = { x: 0, y: 0 };
              });

              animals.forEach((animal1, i) => {
                animals.forEach((animal2, j) => {
                  if (i === j) return;

                  const pos1 = currentPositions[animal1];
                  const pos2 = currentPositions[animal2];
                  const currentDist = Math.sqrt(
                    Math.pow(pos1.x - pos2.x, 2) + Math.pow(pos1.y - pos2.y, 2)
                  ) + 0.001;

                  const targetDist = dissimilarities[i][j] * 0.1;
                  const error = currentDist - targetDist;
                  const force = error / currentDist;

                  gradients[animal1].x += force * (pos1.x - pos2.x) * 0.1;
                  gradients[animal1].y += force * (pos1.y - pos2.y) * 0.1;
                });
              });

              animals.forEach(animal => {
                currentPositions[animal].x = Math.max(0.1, Math.min(0.9, 
                  currentPositions[animal].x - gradients[animal].x
                ));
                currentPositions[animal].y = Math.max(0.1, Math.min(0.9, 
                  currentPositions[animal].y - gradients[animal].y
                ));
              });
            }

            setPositions(currentPositions);
          };

          // Calculate target distances from confusion matrix
          const getTargetDistance = (animal1, animal2) => {
            const i = animals.indexOf(animal1);
            const j = animals.indexOf(animal2);
            if (i === -1 || j === -1) return 0;
            const dissimilarity = Math.max(...confusionMatrix.flat()) - confusionMatrix[i][j];
            return dissimilarity * 0.1;
          };

          // Calculate current distance between two animals
          const getCurrentDistance = (animal1, animal2) => {
            const pos1 = positions[animal1];
            const pos2 = positions[animal2];
            if (!pos1 || !pos2) return 0;
            return Math.sqrt(Math.pow(pos1.x - pos2.x, 2) + Math.pow(pos1.y - pos2.y, 2));
          };

          // Calculate fit quality (inverse of stress for intuitive progress bar)
          const fitQuality = Math.max(0, 100 - stress);

          return (
            <div className="h-screen bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-500 p-3 overflow-hidden">
              <div className="h-full flex flex-col">
                {/* Header */}
                <div className="text-center mb-3">
                  <h1 className="text-3xl font-bold text-white drop-shadow-lg">
                    🎓 MDS Explorer
                  </h1>
                  <p className="text-sm text-white/90">
                    Learn Multidimensional Scaling by exploring confusion matrices
                  </p>
                </div>

                {/* Main Grid Layout */}
                <div className="flex-1 grid grid-cols-10 gap-3 min-h-0">
                  {/* Left Sidebar - Enhanced Target Distances Matrix */}
                  <div className="col-span-4 bg-white rounded-xl shadow-2xl p-4 overflow-auto">
                    <div className="mb-4">
                      <h3 className="font-bold text-gray-800 mb-2 text-base">🎯 Target Distances</h3>
                      <p className="text-xs text-gray-600 mb-3">
                        Drag animals on the canvas to match these target distances. Each cell shows how far apart two animals should be.
                      </p>
                      <div className="flex items-start gap-3 text-xs">
                        <div className="flex items-center gap-1.5">
                          <div className="w-4 h-4 bg-green-100 border-2 border-green-400 rounded"></div>
                          <span className="text-gray-700 font-medium">Good match</span>
                        </div>
                        <div className="flex items-center gap-1.5">
                          <div className="w-4 h-4 bg-yellow-50 border-2 border-yellow-300 rounded"></div>
                          <span className="text-gray-700 font-medium">Needs adjustment</span>
                        </div>
                        <div className="flex items-center gap-1.5">
                          <div className="w-4 h-4 bg-red-100 border-2 border-red-400 rounded"></div>
                          <span className="text-gray-700 font-medium">Poor match</span>
                        </div>
                      </div>
                    </div>

                    {/* Matrix with headers */}
                    <div className="overflow-x-auto">
                      {/* Column headers */}
                      <div className="flex items-end mb-1">
                        <div className="w-24 flex-shrink-0"></div>
                        {animals.map((animal, j) => (
                          <div key={j} className="w-14 flex-shrink-0 flex flex-col items-center">
                            <div className="text-2xl mb-0.5">{animalEmojis[animal] || '❓'}</div>
                          </div>
                        ))}
                      </div>

                      {/* Matrix rows */}
                      <div className="space-y-1">
                        {animals.map((animal1, i) => (
                          <div key={animal1} className="flex items-center">
                            {/* Row label */}
                            <div className="w-24 flex-shrink-0 flex items-center gap-2 pr-2">
                              <div className="text-2xl">{animalEmojis[animal1] || '❓'}</div>
                              <div className="text-xs font-semibold text-gray-700">{animal1}</div>
                            </div>
                            
                            {/* Matrix cells */}
                            {animals.map((animal2, j) => {
                              if (j > i) {
                                return <div key={j} className="w-14 h-9 flex-shrink-0" />;
                              }
                              
                              if (i === j) {
                                return (
                                  <div key={j} className="w-14 h-9 flex-shrink-0 flex items-center justify-center">
                                    <div className="w-12 h-8 bg-gray-100 border-2 border-gray-300 rounded flex items-center justify-center text-gray-400 text-xs font-bold">
                                      —
                                    </div>
                                  </div>
                                );
                              }
                              
                              const targetDist = getTargetDistance(animal1, animal2);
                              const currentDist = getCurrentDistance(animal1, animal2);
                              const error = Math.abs(currentDist - targetDist);
                              const isGood = error < 0.1;
                              const isBad = error > 0.2;
                              
                              return (
                                <div key={j} className="w-14 h-9 flex-shrink-0 flex items-center justify-center">
                                  <div 
                                    className={`w-12 h-8 flex items-center justify-center text-xs font-bold rounded border-2 transition-all ${
                                      isGood ? 'bg-green-100 border-green-400 text-green-800' : 
                                      isBad ? 'bg-red-100 border-red-400 text-red-800' : 
                                      'bg-yellow-50 border-yellow-300 text-yellow-800'
                                    }`}
                                    title={`${animal2} ↔ ${animal1}\nTarget: ${targetDist.toFixed(2)}\nCurrent: ${currentDist.toFixed(2)}\nError: ${error.toFixed(3)}`}
                                  >
                                    {targetDist.toFixed(2)}
                                  </div>
                                </div>
                              );
                            })}
                          </div>
                        ))}
                      </div>
                    </div>

                    <div className="mt-4 pt-3 border-t border-gray-200">
                      <p className="text-xs text-gray-600 leading-relaxed mb-3">
                        <strong className="text-gray-800">💡 How it works:</strong> This matrix shows target distances between each pair of animals. 
                        The confusion matrix determines similarity—animals that sound alike (Cat, Bat, Rat) should be closer together. 
                        Drag the animals on the canvas to match these distances and increase your fit quality!
                      </p>
                      
                      <details className="text-xs text-gray-600">
                        <summary className="font-semibold text-gray-800 cursor-pointer hover:text-indigo-600 mb-2">
                          🔗 URL Parameters (click to expand)
                        </summary>
                        <div className="bg-gray-50 p-3 rounded-lg space-y-2 mt-2">
                          <p className="font-medium text-gray-700">Pass custom data via URL:</p>
                          
                          <div className="space-y-1">
                            <p className="font-mono text-xs text-indigo-600">?animals=Cat:🐱,Dog:🐕,Bird:🐦</p>
                            <p className="text-gray-600">Format: <strong>Label:Emoji</strong> - Comma-separated items with custom emoji (minimum 3)</p>
                          </div>
                          
                          <div className="space-y-1">
                            <p className="font-mono text-xs text-indigo-600">?animals=Apple,Orange,Banana</p>
                            <p className="text-gray-600">Without emoji - will use ❓ for items without predefined emoji</p>
                          </div>
                          
                          <div className="space-y-1">
                            <p className="font-mono text-xs text-indigo-600">?matrix=10,8,2;8,10,3;2,3,10</p>
                            <p className="text-gray-600">Semicolon-separated rows, comma-separated values (must be square matrix)</p>
                          </div>
                          
                          <div className="space-y-1">
                            <p className="font-mono text-xs text-indigo-600">?matrix=[[10,8,2],[8,10,3],[2,3,10]]</p>
                            <p className="text-gray-600">Or JSON array format (URL-encoded)</p>
                          </div>
                          
                          <div className="mt-3 pt-2 border-t border-gray-300">
                            <p className="font-medium text-gray-700 mb-1">Full example with custom emoji:</p>
                            <p className="font-mono text-xs text-indigo-600 break-all">
                              ?animals=Apple:🍎,Orange:🍊,Banana:🍌&matrix=10,7,3;7,10,4;3,4,10
                            </p>
                          </div>
                          
                          <div className="mt-3 pt-2 border-t border-gray-300">
                            <p className="font-medium text-gray-700 mb-1">📋 Tips:</p>
                            <ul className="list-disc list-inside space-y-0.5 text-gray-600">
                              <li>Use <strong>Label:Emoji</strong> for custom icons</li>
                              <li>Or just <strong>Label</strong> for text only (gets ❓ or defaults)</li>
                              <li>Click "🔗 Copy URL" button to share your configuration</li>
                              <li>Matrix must be symmetric and square</li>
                            </ul>
                          </div>
                        </div>
                      </details>
                      
                      <details className="text-xs text-gray-600 mt-3">
                        <summary className="font-semibold text-gray-800 cursor-pointer hover:text-indigo-600 mb-2">
                          🎨 About the Icons
                        </summary>
                        <div className="bg-gray-50 p-3 rounded-lg mt-2 space-y-2">
                          <p className="text-gray-600 leading-relaxed">
                            Icons are <strong>Unicode emoji characters</strong> (🐱 🦇 🐭) that you fully control!
                          </p>
                          
                          <div className="space-y-1">
                            <p className="font-medium text-gray-700">Three ways to specify emoji:</p>
                            <ol className="list-decimal list-inside space-y-0.5 text-gray-600 ml-2">
                              <li><strong>Custom:</strong> Use <code className="bg-white px-1 rounded">Label:Emoji</code> format</li>
                              <li><strong>Defaults:</strong> Use predefined names (Cat, Dog, Bird, etc.)</li>
                              <li><strong>Generic:</strong> Any other label gets ❓</li>
                            </ol>
                          </div>
                          
                          <div className="pt-2 border-t border-gray-300">
                            <p className="text-gray-600 leading-relaxed">
                              <strong>Example URL with custom emoji:</strong>
                            </p>
                            <p className="font-mono text-xs text-indigo-600 bg-white p-1 rounded break-all mt-1">
                              ?animals=Apple:🍎,Orange:🍊,Banana:🍌
                            </p>
                          </div>
                          
                          <div className="pt-2 border-t border-gray-300">
                            <p className="font-medium text-gray-700 mb-1">Find emoji:</p>
                            <ul className="list-disc list-inside space-y-0.5 text-gray-600 ml-2">
                              <li>Windows: Win + . (period)</li>
                              <li>Mac: Cmd + Ctrl + Space</li>
                              <li>Mobile: Emoji keyboard</li>
                              <li>Online: Emojipedia.org</li>
                            </ul>
                          </div>
                        </div>
                      </details>
                    </div>
                  </div>

                  {/* Center - Canvas */}
                  <div className="col-span-6 flex flex-col min-h-0">
                    {/* Fit Quality Indicator */}
                    <div className="bg-gradient-to-br from-blue-900 to-blue-700 text-white p-4 rounded-xl shadow-2xl mb-3">
                      <div className="flex items-center justify-between mb-2">
                        <div>
                          <h3 className="text-xs font-semibold uppercase tracking-wider opacity-90">
                            Fit Quality
                          </h3>
                          <div className="text-3xl font-bold">{fitQuality.toFixed(1)}%</div>
                        </div>
                        <div className="text-right">
                          <h3 className="text-xs font-semibold uppercase tracking-wider opacity-90">
                            Stress
                          </h3>
                          <div className="text-3xl font-bold">{stress.toFixed(1)}%</div>
                        </div>
                      </div>
                      <div className="h-2 bg-white/20 rounded-full overflow-hidden">
                        <div 
                          className="h-full bg-gradient-to-r from-red-400 via-yellow-400 to-green-400 rounded-full transition-all duration-300"
                          style={{ width: `${fitQuality}%` }}
                        />
                      </div>
                      <p className="text-xs opacity-80 mt-2">Higher fit quality is better! Drag animals to improve.</p>
                    </div>

                    {/* Canvas */}
                    <div className="bg-white rounded-xl shadow-2xl p-4 flex-1 flex flex-col min-h-0">
                      <div 
                        ref={canvasRef}
                        className="relative flex-1 bg-gradient-to-br from-slate-900 to-slate-700 rounded-lg overflow-hidden cursor-grab active:cursor-grabbing select-none"
                        onMouseMove={handleMouseMove}
                        onMouseUp={handleMouseUp}
                        onMouseLeave={handleMouseUp}
                        onTouchMove={handleTouchMove}
                        onTouchEnd={handleMouseUp}
                      >
                        {/* Grid */}
                        <div className="absolute inset-0 opacity-10">
                          {[25, 50, 75].map(pos => (
                            <React.Fragment key={pos}>
                              <div className="absolute left-0 right-0 h-px bg-white" style={{ top: `${pos}%` }} />
                              <div className="absolute top-0 bottom-0 w-px bg-white" style={{ left: `${pos}%` }} />
                            </React.Fragment>
                          ))}
                        </div>

                        {/* Strain Lines (when dragging) */}
                        {dragging && (
                          <svg className="absolute inset-0 pointer-events-none" style={{ width: '100%', height: '100%' }}>
                            {animals.filter(a => a !== dragging).map(animal => {
                              const pos1 = positions[dragging];
                              const pos2 = positions[animal];
                              if (!pos1 || !pos2 || !canvasRef.current) return null;
                              
                              const rect = canvasRef.current.getBoundingClientRect();
                              const x1 = pos1.x * rect.width;
                              const y1 = pos1.y * rect.height;
                              const x2 = pos2.x * rect.width;
                              const y2 = pos2.y * rect.height;
                              
                              const currentDist = getCurrentDistance(dragging, animal);
                              const targetDist = getTargetDistance(dragging, animal);
                              const error = Math.abs(currentDist - targetDist);
                              
                              // Color based on error: green=good, yellow=ok, red=bad
                              const color = error < 0.1 ? '#4ade80' : error < 0.2 ? '#fbbf24' : '#f87171';
                              const opacity = error < 0.1 ? 0.3 : error < 0.2 ? 0.5 : 0.7;
                              const strokeWidth = error < 0.1 ? 1 : error < 0.2 ? 2 : 3;
                              
                              return (
                                <line
                                  key={animal}
                                  x1={x1}
                                  y1={y1}
                                  x2={x2}
                                  y2={y2}
                                  stroke={color}
                                  strokeWidth={strokeWidth}
                                  opacity={opacity}
                                  strokeDasharray={currentDist > targetDist ? "5,5" : "none"}
                                />
                              );
                            })}
                          </svg>
                        )}

                        {/* Animals */}
                        {animals.map(animal => {
                          const pos = positions[animal] || { x: 0.5, y: 0.5 };
                          const isDraggingThis = dragging === animal;
                          return (
                            <div
                              key={animal}
                              className={`absolute w-12 h-12 rounded-full flex items-center justify-center text-2xl cursor-grab active:cursor-grabbing transition-transform hover:scale-110 active:scale-95 border-3 border-white shadow-lg ${
                                isDraggingThis ? 'scale-125 z-50' : ''
                              }`}
                              style={{
                                left: `${pos.x * 100}%`,
                                top: `${pos.y * 100}%`,
                                transform: 'translate(-50%, -50%)',
                                background: getColorForAnimal(animal),
                              }}
                              onMouseDown={(e) => handleMouseDown(animal, e)}
                              onTouchStart={(e) => {
                                e.preventDefault();
                                setDragging(animal);
                              }}
                            >
                              {animalEmojis[animal] || '❓'}
                              <div className="absolute top-full mt-1 bg-black/70 text-white px-2 py-0.5 rounded text-xs font-semibold whitespace-nowrap pointer-events-none">
                                {animal}
                              </div>
                            </div>
                          );
                        })}
                      </div>

                      {/* Controls */}
                      <div className="flex gap-2 mt-3">
                        <button 
                          onClick={handleReset}
                          className="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-lg transition-all hover:shadow-md active:scale-95 text-sm"
                        >
                          🔄 Reset
                        </button>
                        <button 
                          onClick={handleAutoSolve}
                          className="flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-semibold py-2 px-4 rounded-lg transition-all hover:shadow-lg active:scale-95 text-sm"
                        >
                          ✨ Auto-Solve
                        </button>
                        <button 
                          onClick={handleCopyURL}
                          className="flex-1 bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 text-white font-semibold py-2 px-4 rounded-lg transition-all hover:shadow-lg active:scale-95 text-sm"
                          title="Copy shareable URL with current configuration"
                        >
                          🔗 Copy URL
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          );
        }

        ReactDOM.render(<MDSExplorer />, document.getElementById('root'));
    </script>
</body>
</html>